name: Build

on:
  workflow_dispatch:
    inputs:
      push_image:
        description: 'Push the image to Docker Hub'
        default: false
        type: boolean
  push:
    branches:
      - 'main'
    tags:
      - 'v*'

jobs:
  docker:
    uses: enescakir/multi-platform-docker/.github/workflows/build.yml@main
    with:
      image-name: ubicloud/ubicloud
      amd64-runner: ubicloud-standard-8
      arm64-runner: ubicloud-standard-8-arm
      metadata-tags: |
        type=sha,prefix=
        type=ref,event=branch
        type=raw,value=latest,enable={{is_default_branch}}
        type=semver,pattern={{version}}
        type=semver,pattern={{major}}.{{minor}}
      push-image: ${{ inputs.push_image }}
    secrets:
      registry-username: ${{ secrets.DOCKERHUB_USERNAME }}
      registry-password: ${{ secrets.DOCKERHUB_TOKEN }}
